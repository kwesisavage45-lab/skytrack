<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkyTrack Pro | Secure Access</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg:#0f172a; --card:rgba(30,41,59,0.75); --text:#f8fafc;
            --text-dim:#94a3b8; --accent:#38bdf8; --border:rgba(255,255,255,0.1);
            --modal-bg:rgba(15,23,42,0.97);
        }
        [data-theme="light"] {
            --bg:#f8fafc; --card:rgba(255,255,255,0.95); --text:#0f172a;
            --text-dim:#475569; --accent:#0284c7; --border:rgba(0,0,0,0.1);
            --modal-bg:rgba(255,255,255,0.98);
        }
        *{margin:0;padding:0;box-sizing:border-box;}
        body{
            background-color:var(--bg);
            background-image:radial-gradient(circle at top right,rgba(56,189,248,0.13),transparent 60%),
                             radial-gradient(circle at bottom left,rgba(56,189,248,0.08),transparent 60%);
            color:var(--text);font-family:'Inter',sans-serif;
            min-height:100vh;display:flex;align-items:center;justify-content:center;overflow:hidden;
        }
        .login-container{width:100%;max-width:430px;padding:20px;animation:slideUp 0.55s ease;z-index:10;}
        .glass-card{
            background:var(--card);padding:2.5rem;border-radius:28px;
            border:1px solid var(--border);backdrop-filter:blur(20px);
            box-shadow:0 25px 60px rgba(0,0,0,0.35);text-align:center;
        }
        .logo{font-size:1.7rem;font-weight:800;color:var(--accent);text-decoration:none;display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:1.8rem;}
        h2{margin-bottom:0.4rem;font-weight:800;font-size:1.45rem;transition:color 0.3s;}
        .subtitle{color:var(--text-dim);font-size:0.87rem;margin-bottom:1.8rem;}
        .input-group{text-align:left;margin-bottom:1.1rem;position:relative;}
        .input-group label{display:block;font-size:0.72rem;font-weight:700;color:var(--accent);margin-bottom:7px;text-transform:uppercase;letter-spacing:1px;}
        .input-group i.field-icon{position:absolute;left:14px;top:39px;color:var(--text-dim);font-size:0.85rem;}
        .toggle-password{position:absolute;right:14px;top:39px;color:var(--text-dim);cursor:pointer;z-index:5;font-size:0.85rem;background:none;border:none;}
        .toggle-password:hover{color:var(--accent);}
        .input-group input{
            width:100%;padding:13px 44px;border-radius:12px;
            border:1.5px solid var(--border);background:rgba(0,0,0,0.18);
            color:var(--text);outline:none;font-size:0.93rem;font-family:inherit;
            transition:border-color 0.2s,box-shadow 0.2s;
        }
        [data-theme="light"] .input-group input{background:#fff;color:#0f172a;border-color:#e2e8f0;}
        .input-group input:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(56,189,248,0.14);}
        .remember-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:1.4rem;}
        .remember-label{display:flex;align-items:center;gap:8px;font-size:0.82rem;color:var(--text-dim);cursor:pointer;user-select:none;}
        .remember-label input[type="checkbox"]{width:15px;height:15px;accent-color:var(--accent);cursor:pointer;padding:0;border:none;}
        .forgot-link{color:var(--accent);font-size:0.8rem;cursor:pointer;font-weight:600;background:none;border:none;}
        .forgot-link:hover{text-decoration:underline;}
        .btn-primary{
            width:100%;background:var(--accent);color:#fff;padding:0.95rem;border-radius:12px;border:none;
            font-weight:800;font-size:1rem;cursor:pointer;letter-spacing:0.3px;
            box-shadow:0 8px 20px rgba(56,189,248,0.28);transition:transform 0.2s,box-shadow 0.2s,opacity 0.2s;
        }
        .btn-primary:hover{transform:translateY(-2px);box-shadow:0 12px 28px rgba(56,189,248,0.4);}
        .btn-primary:disabled{opacity:0.65;cursor:not-allowed;transform:none;}
        .auth-footer{margin-top:1.5rem;font-size:0.84rem;color:var(--text-dim);}
        .auth-footer a{color:var(--accent);text-decoration:none;font-weight:700;cursor:pointer;}
        .auth-footer a:hover{text-decoration:underline;}
        .auth-error{
            background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.3);
            color:#ef4444;font-size:0.82rem;font-weight:600;padding:10px 14px;
            border-radius:10px;margin-bottom:14px;display:none;text-align:left;
        }
        /* Toast */
        .toast{
            position:fixed;top:24px;left:50%;transform:translateX(-50%) translateY(-100px);
            background:#22c55e;color:#fff;font-weight:800;font-size:0.88rem;
            padding:14px 28px;border-radius:50px;z-index:9999;
            box-shadow:0 8px 30px rgba(34,197,94,0.4);
            display:flex;align-items:center;gap:10px;
            transition:transform 0.45s cubic-bezier(0.34,1.56,0.64,1);pointer-events:none;
        }
        .toast.show{transform:translateX(-50%) translateY(0);}
        /* Modal */
        .modal{position:fixed;inset:0;background:rgba(0,0,0,0.75);display:none;align-items:center;justify-content:center;z-index:200;backdrop-filter:blur(6px);}
        .modal.open{display:flex;}
        .modal-content{
            background:var(--modal-bg);padding:2.5rem;border-radius:22px;
            width:90%;max-width:400px;border:1px solid var(--border);text-align:center;
            animation:slideUp 0.3s ease;
        }
        .modal-content h3{margin-bottom:0.4rem;font-size:1.1rem;font-weight:800;}
        .modal-content p{color:var(--text-dim);font-size:0.85rem;margin:10px 0 18px;}
        .modal-content input{
            width:100%;padding:13px 16px;border-radius:12px;
            border:1.5px solid var(--border);background:rgba(0,0,0,0.12);
            color:var(--text);outline:none;margin-bottom:14px;font-family:inherit;font-size:0.93rem;
            transition:border-color 0.2s;
        }
        [data-theme="light"] .modal-content input{background:#f8fafc;color:#0f172a;}
        .modal-content input:focus{border-color:var(--accent);}
        .back-home{position:fixed;top:22px;left:22px;color:var(--text-dim);text-decoration:none;font-size:0.85rem;display:flex;align-items:center;gap:7px;font-weight:600;z-index:50;transition:color 0.2s;}
        .back-home:hover{color:var(--accent);}
        #theme-toggle{position:fixed;top:20px;right:22px;background:none;border:none;color:var(--text);cursor:pointer;font-size:1.2rem;z-index:50;}
        .hidden{display:none!important;}
        @keyframes slideUp{from{opacity:0;transform:translateY(28px);}to{opacity:1;transform:translateY(0);}}
    </style>
</head>
<body>

<a href="index.html" class="back-home"><i class="fas fa-arrow-left"></i> Home</a>
<button id="theme-toggle"><i class="fas fa-moon"></i></button>

<div class="toast" id="successToast">
    <i class="fas fa-check-circle"></i><span id="toastMsg">Done!</span>
</div>

<div class="login-container">
    <div class="glass-card">
        <div class="logo"><i class="fas fa-paper-plane"></i> SkyTrack Pro</div>
        <h2 id="viewTitle">Welcome Back</h2>
        <p class="subtitle" id="viewSubtitle">Access your elite flight dashboard</p>

        <div class="auth-error" id="authError"></div>

        <form id="authForm" onsubmit="handleAuth(event)" novalidate>
            <div class="input-group hidden" id="nameGroup">
                <label>Full Name</label>
                <i class="fas fa-user field-icon"></i>
                <input type="text" id="regName" placeholder="Your full name" autocomplete="name">
            </div>
            <div class="input-group">
                <label>Email Address</label>
                <i class="fas fa-envelope field-icon"></i>
                <input type="email" id="email" placeholder="you@example.com" required autocomplete="email">
            </div>
            <div class="input-group">
                <label>Password</label>
                <i class="fas fa-lock field-icon"></i>
                <input type="password" id="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required autocomplete="current-password" minlength="6">
                <button type="button" class="toggle-password" onclick="togglePwd('password',this)"><i class="fas fa-eye"></i></button>
            </div>
            <div class="input-group hidden" id="confirmGroup">
                <label>Confirm Password</label>
                <i class="fas fa-lock field-icon"></i>
                <input type="password" id="confirmPwd" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="new-password" minlength="6">
                <button type="button" class="toggle-password" onclick="togglePwd('confirmPwd',this)"><i class="fas fa-eye"></i></button>
            </div>
            <div class="remember-row" id="rememberRow">
                <label class="remember-label">
                    <input type="checkbox" id="rememberMe"> Remember me
                </label>
                <button type="button" class="forgot-link" onclick="openModal()">Forgot password?</button>
            </div>
            <button type="submit" class="btn-primary" id="submitBtn">Sign In to Dashboard</button>
        </form>

        <div class="auth-footer" id="switchFooter">
            Don't have an account? <a onclick="switchToSignup()">Create one</a>
        </div>
    </div>
</div>

<!-- Forgot Password Modal -->
<div class="modal" id="forgotModal">
    <div class="modal-content">
        <i class="fas fa-key fa-2x" style="color:var(--accent);margin-bottom:1rem;"></i>
        <h3>Reset Password</h3>
        <p>Enter your email and we'll send a reset link right away.</p>
        <div class="auth-error" id="resetError"></div>
        <input type="email" id="resetEmail" placeholder="your@email.com">
        <button class="btn-primary" onclick="handleReset()">Send Reset Link</button>
        <a onclick="closeModal()" style="display:block;margin-top:14px;font-size:0.8rem;color:var(--text-dim);cursor:pointer;">Cancel</a>
    </div>
</div>

<!-- Firebase -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
    import {
        getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword,
        sendPasswordResetEmail, updateProfile,
        browserLocalPersistence, browserSessionPersistence,
        setPersistence, onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";

    const app  = initializeApp({
        apiKey:"AIzaSyAcnU7sDm8pWkWssgxMPA4q2rdpS8a6qDw",
        authDomain:"skytrack-28c83.firebaseapp.com",
        projectId:"skytrack-28c83",
        storageBucket:"skytrack-28c83.firebasestorage.app",
        messagingSenderId:"876231264024",
        appId:"1:876231264024:web:eb42a685ee2bad2020c06d"
    });
    const auth = getAuth(app);

    onAuthStateChanged(auth, user => {
        if (user) {
            localStorage.setItem('isLoggedIn','true');
            localStorage.setItem('userEmail', user.email || '');
            localStorage.setItem('userName',  user.displayName || '');
            window.location.href = 'index.html';
        } else {
            window._fbReady = true;
        }
    });

    window._fb = {
        auth, signInWithEmailAndPassword, createUserWithEmailAndPassword,
        sendPasswordResetEmail, updateProfile,
        browserLocalPersistence, browserSessionPersistence, setPersistence
    };
</script>

<script>
    let isSignup = false;

    function showErr(msg, id='authError'){ const e=document.getElementById(id); e.textContent=msg; e.style.display='block'; }
    function clearErr(id='authError')  { const e=document.getElementById(id); e.textContent=''; e.style.display='none'; }

    function showToast(msg){
        document.getElementById('toastMsg').textContent = msg;
        const t = document.getElementById('successToast');
        t.classList.add('show');
        setTimeout(()=>t.classList.remove('show'), 3800);
    }

    function togglePwd(id, btn){
        const inp = document.getElementById(id);
        const ico = btn.querySelector('i');
        inp.type = inp.type==='password' ? 'text' : 'password';
        ico.classList.toggle('fa-eye');
        ico.classList.toggle('fa-eye-slash');
    }

    function switchToSignup(){
        isSignup=true;
        document.getElementById('viewTitle').textContent   = 'Create Account';
        document.getElementById('viewSubtitle').textContent= 'Join the SkyTrack Pro network';
        document.getElementById('submitBtn').textContent   = 'Create My Account';
        document.getElementById('switchFooter').innerHTML  = 'Already have an account? <a onclick="switchToLogin()">Sign in</a>';
        document.getElementById('nameGroup').classList.remove('hidden');
        document.getElementById('confirmGroup').classList.remove('hidden');
        document.getElementById('rememberRow').style.display = 'none';
        clearErr();
    }

    function switchToLogin(){
        isSignup=false;
        document.getElementById('viewTitle').textContent   = 'Welcome Back';
        document.getElementById('viewSubtitle').textContent= 'Access your elite flight dashboard';
        document.getElementById('submitBtn').textContent   = 'Sign In to Dashboard';
        document.getElementById('switchFooter').innerHTML  = "Don't have an account? <a onclick=\"switchToSignup()\">Create one</a>";
        document.getElementById('nameGroup').classList.add('hidden');
        document.getElementById('confirmGroup').classList.add('hidden');
        document.getElementById('rememberRow').style.display = '';
        clearErr();
    }

    function openModal()  { document.getElementById('forgotModal').classList.add('open'); }
    function closeModal() { document.getElementById('forgotModal').classList.remove('open'); clearErr('resetError'); }

    function waitFB(){ return new Promise(r=>{ const c=()=>window._fb?r():setTimeout(c,60); c(); }); }

    function friendlyErr(code){
        return ({
            'auth/user-not-found':       'No account found with that email.',
            'auth/wrong-password':        'Incorrect password.',
            'auth/invalid-credential':    'Invalid email or password.',
            'auth/email-already-in-use':  'That email is already registered.',
            'auth/weak-password':         'Password must be at least 6 characters.',
            'auth/invalid-email':         'Please enter a valid email.',
            'auth/too-many-requests':     'Too many attempts â€” try again later.',
            'auth/network-request-failed':'Network error. Check your connection.',
        }[code] || 'Something went wrong. Please try again.');
    }

    async function handleAuth(e){
        e.preventDefault();
        clearErr();
        const btn = document.getElementById('submitBtn');
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Processingâ€¦';

        const email    = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;
        const remember = document.getElementById('rememberMe').checked;

        await waitFB();
        const fb = window._fb;

        try {
            const persist = remember ? fb.browserLocalPersistence : fb.browserSessionPersistence;
            await fb.setPersistence(fb.auth, persist);

            if(isSignup){
                const name    = document.getElementById('regName').value.trim();
                const confirm = document.getElementById('confirmPwd').value;
                if(!name)            { showErr('Please enter your full name.');      resetBtn(btn); return; }
                if(password!==confirm){ showErr('Passwords do not match.');           resetBtn(btn); return; }

                const cred = await fb.createUserWithEmailAndPassword(fb.auth, email, password);
                await fb.updateProfile(cred.user, { displayName: name });
                localStorage.setItem('isLoggedIn','true');
                localStorage.setItem('userEmail', email);
                localStorage.setItem('userName',  name);
                showToast('ðŸŽ‰ Account created! Welcome to SkyTrack Pro.');
                setTimeout(()=>{ window.location.href='index.html'; }, 2300);

            } else {
                const cred = await fb.signInWithEmailAndPassword(fb.auth, email, password);
                localStorage.setItem('isLoggedIn','true');
                localStorage.setItem('userEmail', cred.user.email||'');
                localStorage.setItem('userName',  cred.user.displayName||'');
                showToast('âœˆ Signed in! Loading your dashboardâ€¦');
                setTimeout(()=>{ window.location.href='index.html'; }, 1600);
            }
        } catch(err){
            resetBtn(btn);
            showErr(friendlyErr(err.code));
        }
    }

    async function handleReset(){
        clearErr('resetError');
        const email = document.getElementById('resetEmail').value.trim();
        if(!email){ showErr('Enter your email address.','resetError'); return; }
        await waitFB();
        try {
            await window._fb.sendPasswordResetEmail(window._fb.auth, email);
            closeModal();
            showToast('ðŸ“§ Reset link sent! Check your inbox.');
        } catch(err){
            showErr(friendlyErr(err.code),'resetError');
        }
    }

    function resetBtn(btn){
        btn.disabled=false;
        btn.textContent = isSignup ? 'Create My Account' : 'Sign In to Dashboard';
    }

    // Theme
    const themeBtn  = document.getElementById('theme-toggle');
    const html      = document.documentElement;
    function setTheme(t){
        html.setAttribute('data-theme',t);
        themeBtn.querySelector('i').className = t==='light'?'fas fa-sun':'fas fa-moon';
    }
    themeBtn.addEventListener('click',()=>{
        const next = html.getAttribute('data-theme')==='dark'?'light':'dark';
        setTheme(next); localStorage.setItem('theme',next);
    });
    setTheme(localStorage.getItem('theme')||'dark');

    // Close modal on backdrop click
    document.getElementById('forgotModal').addEventListener('click',function(e){ if(e.target===this) closeModal(); });
</script>
</body>
</html>
